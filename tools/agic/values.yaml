# Complete values.yaml for AGIC (with ServiceAccount block configured for Workload Identity)
# Replace <UAMI_CLIENT_ID_OR_AAD_APP_CLIENT_ID> with your actual identity client id

verbosityLevel: 3

image:
  repository: mcr.microsoft.com/azure-application-gateway/kubernetes-ingress
  tag: 1.9.4
  pullPolicy: Always

kubernetes:
  # Leave empty to watch all namespaces
  watchNamespace: ""
  httpServicePort: 8123
  multiClusterMode: false
  nodeSelector: {}
  tolerations: []
  affinity: {}
  securityContext:
    runAsUser: 0
  containerSecurityContext: {}
  podAnnotations: {}
  resources: {}
  volumes: {}
  ingressClassResource:
    name: azure-application-gateway
    enabled: true
    default: false
    controllerValue: "azure/application-gateway"

# Application Gateway configuration
appgw:
  # Preferred: full resource id
  applicationGatewayID: "/subscriptions/1c31cbbc-25c4-40cf-8e4e-44be901aa7ef/resourceGroups/pardeep-rg-0607/providers/Microsoft.Network/applicationGateways/applicationgateway"

  # Alternative fields (kept for reference)
  subscriptionId: "1c31cbbc-25c4-40cf-8e4e-44be901aa7ef"
  resourceGroup: "pardeep-rg-0607"
  name: "applicationgateway"
  # subnetPrefix: "10.1.0.0/16"   # only if AGIC should create AppGw

# Authentication with Azure Resource Manager (Workload Identity)
armAuth:
  type: workloadIdentity
  identityClientID: "<UAMI_CLIENT_ID_OR_AAD_APP_CLIENT_ID>"

# Node scheduling (legacy duplicate kept for compatibility)
nodeSelector: {}

# RBAC - set true if your cluster enforces RBAC
rbac:
  enabled: true

# Pod security / resources / extra mounts (customize as needed)
podSecurityContext: {}
containerSecurityContext: {}
podAnnotations: {}
resources: {}
volumes: {}

# Optional: set ingressClass override
# ingressClass: agic-2

# Optional: additional settings
# reconcilePeriodSeconds: 30

# Optional: enable metrics / prometheus scraping (example)
metrics:
  enabled: false
  serviceMonitor:
    enabled: false

# Optional: tolerations/affinity for scheduling
tolerations: []
affinity: {}

# Optional: extra args to AGIC container
extraArgs: {}

# -------------------------
# ServiceAccount configuration
# -------------------------
# Using Workload Identity: create ServiceAccount and annotate it with the identity client id.
serviceAccount:
  create: true
  name: agicserviceaccount
  annotations:
    azure.workload.identity/client-id: "<UAMI_CLIENT_ID_OR_AAD_APP_CLIENT_ID>"

# If you prefer to manage SA outside Helm, set create: false and ensure SA exists with same name/annotation.

# Optional: nodePort / service type overrides
service:
  type: ClusterIP
  port: 8123

# Optional: imagePullSecrets
imagePullSecrets: []

# Notes:
# 1) Replace <UAMI_CLIENT_ID_OR_AAD_APP_CLIENT_ID> with the actual client id used for workload identity.
# 2) Ensure the Azure AD App federated credential exists with subject:
#      system:serviceaccount:kube-system:agic-serviceaccount
#    and audiences include api://AzureADTokenExchange.
# 3) Ensure the identity (principalId) has required Azure roles:
#    - Contributor on Application Gateway (or RG) if AGIC must modify AppGw
#    - Network Contributor on the VNet (or scope containing the subnet) to allow subnet join
#    - Reader on resource group(s) as needed
# 4) Validate template before install:
#    helm template . --name-template agic --namespace kube-system --kube-version 1.33 -f values.yaml --include-crds
# 5) Install/upgrade:
#    helm upgrade --install agic application-gateway-ingress-controller/ingress-azure --namespace kube-system -f values.yaml
