replicaCount: 1

image:
  registry: ghcr.io
  repository: headlamp-k8s/headlamp
  pullPolicy: IfNotPresent
  tag: ""

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""
namespaceOverride: ""

# Shared volume definition for token
volumes:
  - name: shared-token
    emptyDir: {}
  - name: plugins
    emptyDir: {}

# Init container
initContainers:
  - name: sa-token-retrieval
    image: alpine/kubectl
    imagePullPolicy: IfNotPresent
    command:
      - /bin/sh
      - -c
      - |
        set -e

        echo "ðŸ” Reading ServiceAccount token..."
        TOKEN_PATH="/var/run/secrets/kubernetes.io/serviceaccount/token"

        if [ ! -f "$TOKEN_PATH" ]; then
          echo "âŒ ServiceAccount token not found!"
          exit 1
        fi

        TOKEN=$(cat $TOKEN_PATH)
        echo "âœ… Token retrieved (length: ${#TOKEN})"

        # Write token to shared volume
        mkdir -p /shared
        echo "$TOKEN" > /shared/headlamp-sa.token

        echo "ðŸ“Œ Kubernetes API access test..."
        kubectl get ns >/dev/null 2>&1 && echo "âœ… API access working"
    volumeMounts:
      - name: shared-token
        mountPath: /shared

config:
  inCluster: true
  baseURL: ""
  oidc:
    secret:
      create: true
      name: oidc
    clientID: ""
    clientSecret: ""
    issuerURL: ""
    scopes: ""
    callbackURL: ""
    validatorClientID: ""
    validatorIssuerURL: ""
    useAccessToken: false
    usePKCE: false
    externalSecret:
      enabled: true
      name: oidc
    meUserInfoURL: ""
  pluginsDir: "/headlamp/plugins"
  enableHelm: false
  watchPlugins: false
  extraArgs: []

automountServiceAccountToken: true

serviceAccount:
  create: true
  annotations: {}
  name: ""

clusterRoleBinding:
  create: true
  clusterRoleName: cluster-admin
  annotations: {}

deploymentAnnotations: {}
podAnnotations: {}
podLabels: {}

podSecurityContext: {}

securityContext:
  runAsNonRoot: true
  privileged: false
  runAsUser: 100
  runAsGroup: 101

service:
  annotations: {}
  type: ClusterIP
  port: 80
  clusterIP: ""
  loadBalancerIP: ""
  loadBalancerSourceRanges: []
  nodePort: null

# Main container
containers:
  - name: headlamp
    image: ghcr.io/headlamp-k8s/headlamp:v0.39.0
    args:
      - -in-cluster
      - -plugins-dir=/headlamp/plugins
      - -oidc-client-id=$(OIDC_CLIENT_ID)
      - -oidc-client-secret=$(OIDC_CLIENT_SECRET)
      - -oidc-idp-issuer-url=$(OIDC_ISSUER_URL)
      - -oidc-scopes=$(OIDC_SCOPES)
    volumeMounts:
      - name: shared-token
        mountPath: /shared
      - name: plugins
        mountPath: /headlamp/plugins

volumeMounts:
  - name: plugins
    mountPath: "/headlamp/plugins"

persistentVolumeClaim:
  enabled: false
  annotations: {}
  accessModes: []
  size: ""
  storageClassName: ""
  selector: {}
  volumeMode: ""

ingress:
  enabled: false
  annotations: {}
  labels: {}
  ingressClassName: ""
  hosts: []
  tls: []

resources:
  requests:
    cpu: "100m"
    memory: 128Mi
  limits:
    cpu: 100m
    memory: 128Mi

nodeSelector: {}
tolerations: []
affinity: {}
priorityClassName: ""

pluginsManager:
  enabled: false
  configFile: "plugin.yml"
  configContent: ""
  baseImage: node:lts-alpine
  version: latest
  securityContext: {}

podDisruptionBudget:
  enabled: false
  minAvailable: 0
  maxUnavailable: null
  unhealthyPodEvictionPolicy: null

extraManifests: []
